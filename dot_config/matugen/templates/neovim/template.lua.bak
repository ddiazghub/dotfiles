-- Auto-generated by Matugen
--
local function mix(color1, color2, weight)
	-- Helper to convert hex to RGB
	local function hexToRgb(hex)
		hex = hex:gsub("#", "")
		return tonumber("0x" .. hex:sub(1, 2)), tonumber("0x" .. hex:sub(3, 4)), tonumber("0x" .. hex:sub(5, 6))
	end

	local r1, g1, b1 = hexToRgb(color1)
	local r2, g2, b2 = hexToRgb(color2)

	-- Interpolate each channel
	local r = math.floor(r1 * (1 - weight) + r2 * weight)
	local g = math.floor(g1 * (1 - weight) + g2 * weight)
	local b = math.floor(b1 * (1 - weight) + b2 * weight)

	return string.format("#%02x%02x%02x", r, g, b)
end

-- Load tokyonight as fallback for any highlight groups not set by mini.base16
vim.cmd.colorscheme("tokyonight-night")

require("mini.base16").setup({
	palette = {
		base00 = "{{colors.background.default.hex}}",
		base01 = "{{colors.surface_container_lowest.default.hex}}",
		base02 = "{{colors.surface_container_low.default.hex}}",
		base03 = "{{colors.outline_variant.default.hex}}",
		-- base03 = "{{colors.outline.default.hex}}",
		base04 = "{{colors.on_surface_variant.default.hex}}",
		base05 = "{{colors.on_surface.default.hex}}",
		base06 = "{{colors.inverse_on_surface.default.hex}}",
		base07 = "{{colors.surface_bright.default.hex}}",
		base08 = "{{colors.error.default.hex}}",
		base09 = "{{colors.tertiary.default.hex}}",
		base0A = "{{colors.secondary.default.hex}}",
		base0B = "{{colors.primary.default.hex}}",
		base0C = "{{colors.on_tertiary_container.default.hex}}",
		-- base0C = "{{colors.tertiary_container.default.hex}}",
		-- base0D = "{{colors.on_primary_container.default.hex}}",
		base0D = mix("{{colors.tertiary_container.default.hex}}", "{{colors.tertiary.default.hex}}", 0.7),
		-- base0D = "{{colors.primary_container.default.hex}}",
		base0E = mix("{{colors.inverse_primary.default.hex}}", "{{colors.primary.default.hex}}", 0.4),
		-- base0F = "{{colors.on_error_container.default.hex}}",
		base0F = mix("{{colors.error_container.default.hex}}", "{{colors.error.default.hex}}", 0.4),
	},
	plugins = {
		default = true,
		["folke/todo-comments.nvim"] = true,
	},
})

-- We first theme base16, but we also need to fix some other colors that don't
-- contrast well by default

-- Helper function to set multiple highlight groups at once
local function set_hl_mutliple(groups, value)
	for _, v in pairs(groups) do
		vim.api.nvim_set_hl(0, v, value)
	end
end

-- Make selected text stand out more
vim.api.nvim_set_hl(0, "Visual", {
	bg = "{{colors.primary_container.default.hex}}",
	-- fg = "{{colors.background.default.hex}}",
})

-- Comments
set_hl_mutliple({ "TSComment", "Comment" }, {
	fg = "{{colors.outline.default.hex}}",
	italic = true,
})

-- blink.pairs rainbow brackets
vim.api.nvim_set_hl(0, "BlinkPairsOrange", { fg = "{{colors.tertiary.default.hex}}" })
vim.api.nvim_set_hl(0, "BlinkPairsPurple", { fg = "{{colors.secondary.default.hex}}" })
vim.api.nvim_set_hl(0, "BlinkPairsBlue", { fg = "{{colors.primary.default.hex}}" })
vim.api.nvim_set_hl(0, "BlinkPairsUnmatched", { fg = "{{colors.error_container.default.hex}}" })
vim.api.nvim_set_hl(0, "BlinkPairsMatchParen", {
	fg = "{{colors.on_primary.default.hex}}",
	bg = "{{colors.primary.default.hex}}",
	bold = true,
})

-- Floating window borders
vim.api.nvim_set_hl(0, "FloatBorder", {
	fg = "{{colors.primary.default.hex}}",
	bg = "NONE",
})

vim.api.nvim_set_hl(0, "NormalFloat", {
	bg = "NONE",
})

-- Transparent backgrounds
set_hl_mutliple({
	"Normal",
	"NormalNC",
	"SignColumn",
	"LineNr",
	"EndOfBuffer",
	"Folded",
	"WinSeparator",
}, { bg = "NONE" })

set_hl_mutliple({
	"LineNrAbove",
	"LineNrBelow",
}, { bg = "NONE", fg = "{{colors.outline.default.hex}}" })

vim.api.nvim_set_hl(0, "CursorLine", { bg = "{{colors.on_primary_fixed.default.hex}}" })
vim.api.nvim_set_hl(0, "CursorLineNr", { fg = "{{colors.primary.default.hex}}", bg = "NONE", bold = true })

vim.api.nvim_set_hl(0, "LspReferenceText", {
	bg = "{{colors.primary.default.hex}}",
	fg = "{{colors.on_primary.default.hex}}",
})

-- NonText
vim.api.nvim_set_hl(0, "NonText", { fg = "{{colors.outline.default.hex}}" })

-- Completion menu
vim.api.nvim_set_hl(0, "Pmenu", { bg = "NONE", fg = "{{colors.on_surface.default.hex}}" })
vim.api.nvim_set_hl(0, "PmenuSel", { bg = "{{colors.primary_container.default.hex}}" })
vim.api.nvim_set_hl(0, "PmenuSbar", { bg = "NONE" })
vim.api.nvim_set_hl(0, "PmenuThumb", { bg = "{{colors.outline.default.hex}}" })

vim.api.nvim_set_hl(0, "BlinkCmpDoc", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpDocBorder", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpGhostText", { fg = "{{colors.outline.default.hex}}" })
vim.api.nvim_set_hl(0, "BlinkCmpKindCodeium", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpKindCopilot", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpKindDefault", { fg = "{{colors.on_surface_variant.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpKindSupermaven", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpKindTabNine", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpLabel", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(
	0,
	"BlinkCmpLabelDeprecated",
	{ fg = "{{colors.outline.default.hex}}", bg = "NONE", strikethrough = true }
)
vim.api.nvim_set_hl(0, "BlinkCmpLabelMatch", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpMenu", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpMenuBorder", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpSignatureHelp", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "BlinkCmpSignatureHelpBorder", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })

-- Mini.icons colors (blended with matugen theme)
local mini_azure = mix("#007FFF", "{{colors.primary.default.hex}}", 0.7)
local mini_blue = mix("#0000FF", "{{colors.primary.default.hex}}", 0.7)
local mini_cyan = mix("#00FFFF", "{{colors.primary.default.hex}}", 0.7)
local mini_green = mix("#00FF00", "{{colors.primary.default.hex}}", 0.7)
local mini_grey = mix("#808080", "{{colors.outline.default.hex}}", 0.7)
local mini_orange = mix("#FF8800", "{{colors.primary.default.hex}}", 0.7)
local mini_purple = mix("#8800FF", "{{colors.primary.default.hex}}", 0.7)
local mini_red = mix("#FF0000", "{{colors.error.default.hex}}", 0.7)
local mini_yellow = mix("#FFFF00", "{{colors.primary.default.hex}}", 0.7)

vim.api.nvim_set_hl(0, "MiniIconsAzure", { fg = mini_azure })
vim.api.nvim_set_hl(0, "MiniIconsBlue", { fg = mini_blue })
vim.api.nvim_set_hl(0, "MiniIconsCyan", { fg = mini_cyan })
vim.api.nvim_set_hl(0, "MiniIconsGreen", { fg = mini_green })
vim.api.nvim_set_hl(0, "MiniIconsGrey", { fg = mini_grey })
vim.api.nvim_set_hl(0, "MiniIconsOrange", { fg = mini_orange })
vim.api.nvim_set_hl(0, "MiniIconsPurple", { fg = mini_purple })
vim.api.nvim_set_hl(0, "MiniIconsRed", { fg = mini_red })
vim.api.nvim_set_hl(0, "MiniIconsYellow", { fg = mini_yellow })

-- Noice cmdline and search
set_hl_mutliple({
	"NoiceCmdline",
	"NoiceCmdlinePopup",
	"NoicePopup",
	"NoicePopupmenu",
	"NoiceScrollbar",
}, { bg = "NONE" })

vim.api.nvim_set_hl(0, "NoiceCmdlinePopupBorder", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "NoiceCmdlinePopupBorderSearch", { fg = "{{colors.tertiary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "NoiceCmdlinePopupTitle", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "NoiceCmdlineIcon", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "NoiceCmdlineIconSearch", { fg = "{{colors.tertiary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "NoicePopupBorder", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "NoicePopupmenuBorder", { fg = "{{colors.primary.default.hex}}", bg = "NONE" })

-- Diff/Git colors (blended with matugen theme)
local bg = "{{colors.background.default.hex}}"
local diff_add = mix("#26A641", "{{colors.primary.default.hex}}", 0.5)
local diff_change = mix("#E09B13", "{{colors.tertiary.default.hex}}", 0.5)
local diff_delete = mix("#F85149", "{{colors.error.default.hex}}", 0.5)
local diff_text = mix("#58A6FF", "{{colors.primary.default.hex}}", 0.5)

local diff_add_bg = mix(diff_add, bg, 0.85)
local diff_change_bg = mix(diff_change, bg, 0.85)
local diff_delete_bg = mix(diff_delete, bg, 0.85)
local diff_text_bg = mix(diff_text, bg, 0.75)

-- Diff highlights
vim.api.nvim_set_hl(0, "DiffAdd", { bg = diff_add_bg, fg = diff_add })
vim.api.nvim_set_hl(0, "DiffChange", { bg = diff_change_bg, fg = diff_change })
vim.api.nvim_set_hl(0, "DiffDelete", { bg = diff_delete_bg, fg = diff_delete })
vim.api.nvim_set_hl(0, "DiffText", { bg = diff_text_bg, fg = diff_text })

-- Gitsigns highlights
vim.api.nvim_set_hl(0, "GitSignsAdd", { fg = diff_add, bg = "NONE" })
vim.api.nvim_set_hl(0, "GitSignsChange", { fg = diff_change, bg = "NONE" })
vim.api.nvim_set_hl(0, "GitSignsDelete", { fg = diff_delete, bg = "NONE" })
vim.api.nvim_set_hl(0, "GitSignsChangedelete", { fg = diff_change, bg = "NONE" })
vim.api.nvim_set_hl(0, "GitSignsTopdelete", { fg = diff_delete, bg = "NONE" })
vim.api.nvim_set_hl(0, "GitSignsUntracked", { fg = diff_add, bg = "NONE" })

vim.api.nvim_set_hl(0, "GitSignsAddNr", { fg = diff_add, bg = "NONE" })
vim.api.nvim_set_hl(0, "GitSignsChangeNr", { fg = diff_change, bg = "NONE" })
vim.api.nvim_set_hl(0, "GitSignsDeleteNr", { fg = diff_delete, bg = "NONE" })

vim.api.nvim_set_hl(0, "GitSignsAddLn", { bg = diff_add_bg })
vim.api.nvim_set_hl(0, "GitSignsChangeLn", { bg = diff_change_bg })
vim.api.nvim_set_hl(0, "GitSignsDeleteLn", { bg = diff_delete_bg })

-- Diagnostic colors (blended with matugen theme)
local diag_error = mix("#DB4B4B", "{{colors.error.default.hex}}", 0.5)
local diag_warn = mix("#E0AF68", "{{colors.tertiary.default.hex}}", 0.5)
local diag_info = mix("#0DB9D7", "{{colors.primary.default.hex}}", 0.5)
local diag_hint = mix("#1ABC9C", "{{colors.primary.default.hex}}", 0.5)

local diag_error_bg = mix(diag_error, bg, 0.85)
local diag_warn_bg = mix(diag_warn, bg, 0.85)
local diag_info_bg = mix(diag_info, bg, 0.85)
local diag_hint_bg = mix(diag_hint, bg, 0.90)

-- Diagnostic highlights
vim.api.nvim_set_hl(0, "DiagnosticError", { fg = diag_error })
vim.api.nvim_set_hl(0, "DiagnosticWarn", { fg = diag_warn })
vim.api.nvim_set_hl(0, "DiagnosticInfo", { fg = diag_info })
vim.api.nvim_set_hl(0, "DiagnosticHint", { fg = diag_hint })

-- Diagnostic virtual text (subtle background)
vim.api.nvim_set_hl(0, "DiagnosticVirtualTextError", { fg = diag_error, bg = diag_error_bg })
vim.api.nvim_set_hl(0, "DiagnosticVirtualTextWarn", { fg = diag_warn, bg = diag_warn_bg })
vim.api.nvim_set_hl(0, "DiagnosticVirtualTextInfo", { fg = diag_info, bg = diag_info_bg })
vim.api.nvim_set_hl(0, "DiagnosticVirtualTextHint", { fg = diag_hint, bg = diag_hint_bg })

-- Diagnostic underlines
vim.api.nvim_set_hl(0, "DiagnosticUnderlineError", { undercurl = true, sp = diag_error })
vim.api.nvim_set_hl(0, "DiagnosticUnderlineWarn", { undercurl = true, sp = diag_warn })
vim.api.nvim_set_hl(0, "DiagnosticUnderlineInfo", { undercurl = true, sp = diag_info })
vim.api.nvim_set_hl(0, "DiagnosticUnderlineHint", { undercurl = true, sp = diag_hint })

-- Diagnostic signs
vim.api.nvim_set_hl(0, "DiagnosticSignError", { fg = diag_error, bg = "NONE" })
vim.api.nvim_set_hl(0, "DiagnosticSignWarn", { fg = diag_warn, bg = "NONE" })
vim.api.nvim_set_hl(0, "DiagnosticSignInfo", { fg = diag_info, bg = "NONE" })
vim.api.nvim_set_hl(0, "DiagnosticSignHint", { fg = diag_hint, bg = "NONE" })

-- Todo-comments colors (blended with matugen theme)
local todo_fix = mix("#DB4B4B", "{{colors.error.default.hex}}", 0.5)
local todo_todo = mix("#1ABC9C", "{{colors.secondary.default.hex}}", 0.5)
local todo_hack = mix("#FF9E64", "{{colors.tertiary.default.hex}}", 0.5)
local todo_warn = mix("#E0AF68", "{{colors.tertiary.default.hex}}", 0.5)
local todo_perf = mix("#9D7CD8", "{{colors.secondary.default.hex}}", 0.5)
local todo_note = mix("#7C3AED", "{{colors.primary.default.hex}}", 0.5)
local todo_test = mix("#9D7CD8", "{{colors.secondary.default.hex}}", 0.5)

-- Todo-comments highlight groups
vim.api.nvim_set_hl(0, "TodoBgFIX", { fg = "{{colors.on_error.default.hex}}", bg = todo_fix, bold = true })
vim.api.nvim_set_hl(0, "TodoBgTODO", { fg = "{{colors.on_secondary.default.hex}}", bg = todo_todo, bold = true })
vim.api.nvim_set_hl(0, "TodoBgHACK", { fg = "{{colors.on_tertiary.default.hex}}", bg = todo_hack, bold = true })
vim.api.nvim_set_hl(0, "TodoBgWARN", { fg = "{{colors.on_tertiary.default.hex}}", bg = todo_warn, bold = true })
vim.api.nvim_set_hl(0, "TodoBgPERF", { fg = "{{colors.on_secondary.default.hex}}", bg = todo_perf, bold = true })
vim.api.nvim_set_hl(0, "TodoBgNOTE", { fg = "{{colors.on_primary.default.hex}}", bg = todo_note, bold = true })
vim.api.nvim_set_hl(0, "TodoBgTEST", { fg = "{{colors.on_secondary.default.hex}}", bg = todo_test, bold = true })

vim.api.nvim_set_hl(0, "TodoFgFIX", { fg = todo_fix })
vim.api.nvim_set_hl(0, "TodoFgTODO", { fg = todo_todo })
vim.api.nvim_set_hl(0, "TodoFgHACK", { fg = todo_hack })
vim.api.nvim_set_hl(0, "TodoFgWARN", { fg = todo_warn })
vim.api.nvim_set_hl(0, "TodoFgPERF", { fg = todo_perf })
vim.api.nvim_set_hl(0, "TodoFgNOTE", { fg = todo_note })
vim.api.nvim_set_hl(0, "TodoFgTEST", { fg = todo_test })

vim.api.nvim_set_hl(0, "TodoSignFIX", { fg = todo_fix, bg = "NONE" })
vim.api.nvim_set_hl(0, "TodoSignTODO", { fg = todo_todo, bg = "NONE" })
vim.api.nvim_set_hl(0, "TodoSignHACK", { fg = todo_hack, bg = "NONE" })
vim.api.nvim_set_hl(0, "TodoSignWARN", { fg = todo_warn, bg = "NONE" })
vim.api.nvim_set_hl(0, "TodoSignPERF", { fg = todo_perf, bg = "NONE" })
vim.api.nvim_set_hl(0, "TodoSignNOTE", { fg = todo_note, bg = "NONE" })
vim.api.nvim_set_hl(0, "TodoSignTEST", { fg = todo_test, bg = "NONE" })

-- Snacks Notifier Debug
vim.api.nvim_set_hl(0, "SnacksNotifierDebug", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierBorderDebug", { fg = todo_note, bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierIconDebug", { fg = todo_note })
vim.api.nvim_set_hl(0, "SnacksNotifierTitleDebug", { fg = todo_note })

-- Snacks Notifier Error
vim.api.nvim_set_hl(0, "SnacksNotifierError", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierBorderError", { fg = todo_fix, bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierIconError", { fg = todo_fix })
vim.api.nvim_set_hl(0, "SnacksNotifierTitleError", { fg = todo_fix })

-- Snacks Notifier Info
vim.api.nvim_set_hl(0, "SnacksNotifierInfo", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierBorderInfo", { fg = todo_todo, bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierIconInfo", { fg = todo_todo })
vim.api.nvim_set_hl(0, "SnacksNotifierTitleInfo", { fg = todo_todo })

-- Snacks Notifier Trace
vim.api.nvim_set_hl(0, "SnacksNotifierTrace", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierBorderTrace", { fg = todo_perf, bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierIconTrace", { fg = todo_perf })
vim.api.nvim_set_hl(0, "SnacksNotifierTitleTrace", { fg = todo_perf })

-- Snacks Notifier Warn
vim.api.nvim_set_hl(0, "SnacksNotifierWarn", { fg = "{{colors.on_surface.default.hex}}", bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierBorderWarn", { fg = todo_warn, bg = "NONE" })
vim.api.nvim_set_hl(0, "SnacksNotifierIconWarn", { fg = todo_warn })
vim.api.nvim_set_hl(0, "SnacksNotifierTitleWarn", { fg = todo_warn })

-- Snacks Dashboard
vim.api.nvim_set_hl(0, "SnacksDashboardDesc", { fg = diag_info })
vim.api.nvim_set_hl(0, "SnacksDashboardFooter", { fg = "{{colors.primary.default.hex}}" })
vim.api.nvim_set_hl(0, "SnacksDashboardHeader", { fg = "{{colors.primary.default.hex}}" })
vim.api.nvim_set_hl(0, "SnacksDashboardIcon", { fg = "{{colors.primary.default.hex}}" })
vim.api.nvim_set_hl(0, "SnacksDashboardKey", { fg = "{{colors.tertiary.default.hex}}" })
vim.api.nvim_set_hl(0, "SnacksDashboardSpecial", { fg = "{{colors.secondary.default.hex}}" })
vim.api.nvim_set_hl(0, "SnacksDashboardDir", { fg = "{{colors.outline.default.hex}}" })
